<!DOCTYPE html>
<html>
	<head>
		<meta name='viewport' id='viewport' content='width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no'/>
		<meta charset='UTF-8'/>
		<title>24 Game Calculator</title>
		<style type='text/css'>
body{max-width:800px;margin:0 auto;padding:10px;font-family:serif;text-align:center;font-family:sans;}
select,input[type=text]{line-height:30px;}
select,input[type=button]{height:30px;}
#goal{padding:0 4px;}
		</style>
		<script type='text/javascript'>
Array.prototype.swap = function($a, $b) {
	if ($a == $b) {
		return;
	}
	var $temp = this[$a];
	this[$a] = this[$b];
	this[$b] = $temp;
}
var sort_abcd = function(n) {
	n.sort(function(a,b){return (a > b ? 1 : -1)});
}
var sort_abc = function(n) {
	if (n[0] > n[1]) { n.swap(0, 1); }
	if (n[1] > n[2]) { n.swap(1, 2); }
	if (n[0] > n[1]) { n.swap(0, 1); }
}
var sort_bcd = function(n) {
	if (n[1] > n[2]) { n.swap(1, 2); }
	if (n[2] > n[3]) { n.swap(2, 3); }
	if (n[1] > n[2]) { n.swap(1, 2); }
}
var sort_ab = function(n) {
	if (n[0] > n[1]) { n.swap(0, 1); }
}
var sort_bc = function(n) {
	if (n[1] > n[2]) { n.swap(1, 2); }
}
var sort_cd = function(n) {
	if (n[2] > n[3]) { n.swap(2, 3); }
}
var sort_ab_cd = function(n) {
	if (n[0] > n[1]) { n.swap(0, 1); }
	if (n[2] > n[3]) { n.swap(2, 3); }
}

var TEMPLATES_ALL = [
	{expr:"%d+%d+%d+%d", sort:sort_abcd},
	{expr:"%d+%d+%d-%d", sort:sort_abc},
	{expr:"%d+%d-%d-%d", sort:sort_ab},
	{expr:"%d-%d-%d-%d", sort:null},

	{expr:"%d*%d*%d*%d", sort:sort_abcd},
	{expr:"%d*%d*%d/%d", sort:sort_abc},
	{expr:"%d*%d/%d/%d", sort:sort_ab},
	{expr:"%d/%d/%d/%d", sort:null},

	{expr:"%d+%d+%d*%d", sort:sort_ab_cd},
	{expr:"(%d+%d+%d)*%d", sort:sort_abc},
	{expr:"%d+(%d+%d)*%d", sort:sort_bc},
	{expr:"(%d+%d)*(%d+%d)", sort:sort_ab_cd},

	{expr:"%d+%d*%d*%d", sort:sort_bcd},
	{expr:"(%d+%d)*%d*%d", sort:sort_ab_cd},
	{expr:"%d*%d+%d*%d", sort:sort_ab_cd},
	{expr:"(%d+%d*%d)*%d", sort:sort_bc},

	{expr:"%d+%d+%d/%d", sort:sort_ab},
	{expr:"%d+(%d+%d)/%d", sort:sort_bc},
	{expr:"%d+%d/(%d+%d)", sort:sort_cd},
	{expr:"(%d+%d+%d)/%d", sort:sort_abc},
	{expr:"%d/(%d+%d+%d)", sort:sort_bcd},
	{expr:"(%d+%d)/(%d+%d)", sort:sort_ab_cd},

	{expr:"%d+%d/%d/%d", sort:null},
	{expr:"(%d+%d)/%d/%d", sort:sort_ab},
	{expr:"%d/(%d+%d)/%d", sort:sort_bc},
	{expr:"%d/%d/(%d+%d)", sort:sort_cd},
	{expr:"(%d+%d/%d)/%d", sort:null},
	{expr:"%d/(%d+%d/%d)", sort:null},
	{expr:"%d/%d+%d/%d", sort:null},

	{expr:"%d-%d-%d*%d", sort:sort_cd},
	{expr:"%d-%d*%d-%d", sort:sort_bc},
	{expr:"%d*%d-%d-%d", sort:sort_ab},
	{expr:"%d-(%d-%d)*%d", sort:null},
	{expr:"(%d-%d)*%d-%d", sort:null},
	{expr:"(%d-%d-%d)*%d", sort:null},
	{expr:"(%d-%d)*(%d-%d)", sort:null},

	{expr:"%d-%d*%d*%d", sort:sort_bcd},
	{expr:"%d*%d*%d-%d", sort:sort_abc},
	{expr:"(%d-%d)*%d*%d", sort:sort_cd},
	{expr:"(%d-%d*%d)*%d", sort:sort_bc},
	{expr:"(%d*%d-%d)*%d", sort:sort_ab},
	{expr:"%d*%d-%d*%d", sort:sort_ab_cd},

	{expr:"%d-%d-%d/%d", sort:null},
	{expr:"%d-%d/%d-%d", sort:null},
	{expr:"%d/%d-%d-%d", sort:null},
	{expr:"%d-(%d-%d)/%d", sort:null},
	{expr:"%d-%d/(%d-%d)", sort:null},
	{expr:"(%d-%d)/%d-%d", sort:null},
	{expr:"%d/(%d-%d)-%d", sort:null},
	{expr:"(%d-%d-%d)/%d", sort:null},
	{expr:"%d/(%d-%d-%d)", sort:null},
	{expr:"(%d-%d)/(%d-%d)", sort:null},

	{expr:"%d-%d/%d/%d", sort:null},
	{expr:"%d/%d/%d-%d", sort:null},
	{expr:"%d/%d-%d/%d", sort:null},
	{expr:"(%d-%d)/%d/%d", sort:null},
	{expr:"%d/(%d-%d)/%d", sort:null},
	{expr:"%d/%d/(%d-%d)", sort:null},
	{expr:"(%d-%d/%d)/%d", sort:null},
	{expr:"(%d/%d-%d)/%d", sort:null},
	{expr:"%d/(%d-%d/%d)", sort:null},
	{expr:"%d/(%d/%d-%d)", sort:null},

	{expr:"%d+%d-%d*%d", sort:sort_ab_cd},
	{expr:"%d+%d*%d-%d", sort:sort_bc},
	{expr:"%d+(%d-%d)*%d", sort:null},
	{expr:"%d-(%d+%d)*%d", sort:sort_bc},
	{expr:"(%d+%d)*%d-%d", sort:sort_ab},
	{expr:"(%d+%d-%d)*%d", sort:sort_ab},
	{expr:"(%d+%d)*(%d-%d)", sort:sort_ab},

	{expr:"%d+%d-%d/%d", sort:sort_ab},
	{expr:"%d+%d/%d-%d", sort:null},
	{expr:"%d+(%d-%d)/%d", sort:null},
	{expr:"%d+%d/(%d-%d)", sort:null},
	{expr:"%d-(%d+%d)/%d", sort:sort_bc},
	{expr:"%d-%d/(%d+%d)", sort:sort_cd},
	{expr:"(%d+%d)/%d-%d", sort:sort_ab},
	{expr:"%d/(%d+%d)-%d", sort:sort_bc},
	{expr:"(%d+%d-%d)/%d", sort:sort_ab},
	{expr:"%d/(%d+%d-%d)", sort:sort_bc},
	{expr:"(%d+%d)/(%d-%d)", sort:sort_ab},
	{expr:"(%d-%d)/(%d+%d)", sort:sort_cd},

	{expr:"%d+%d*%d/%d", sort:sort_bc},
	{expr:"(%d+%d)*%d/%d", sort:sort_ab},
	{expr:"%d/(%d+%d)*%d", sort:sort_bc},
	{expr:"%d*%d+%d/%d", sort:sort_ab},
	{expr:"(%d+%d*%d)/%d", sort:sort_bc},
	{expr:"%d/(%d+%d*%d)", sort:sort_cd},
	{expr:"(%d+%d/%d)*%d", sort:null},

	{expr:"%d-%d*%d/%d", sort:sort_bc},
	{expr:"%d*%d/%d-%d", sort:sort_ab},
	{expr:"(%d-%d)*%d/%d", sort:null},
	{expr:"%d/(%d-%d)*%d", sort:null},
	{expr:"%d*%d-%d/%d", sort:sort_ab},
	{expr:"%d/%d-%d*%d", sort:sort_cd},
	{expr:"(%d-%d*%d)/%d", sort:sort_bc},
	{expr:"%d/(%d-%d*%d)", sort:sort_cd},
	{expr:"(%d*%d-%d)/%d", sort:sort_ab},
	{expr:"%d/(%d*%d-%d)", sort:sort_bc},
	{expr:"(%d-%d/%d)*%d", sort:null},
	{expr:"(%d/%d-%d)*%d", sort:null},
];

/* Init Template */
for (i = 0; i < TEMPLATES_ALL.length; i++) {
	TEMPLATES_ALL[i].calc = Function('n',('return '+TEMPLATES_ALL[i].expr+';').replace('%d','n[0]').replace('%d','n[1]').replace('%d','n[2]').replace('%d','n[3]'));
}
/* Init Template End */

function getAnswer(goal, num1, num2, num3, num4) {
	var answer_all = [];
	var array = [num1, num2, num3, num4], result;
	var t, template, sort_param;
	var i, j, k, a = [0, 0, 0, 0];

	for (t = 0; t < TEMPLATES_ALL.length; t++) {
		sort_func = TEMPLATES_ALL[t].sort;
		calc_func = TEMPLATES_ALL[t].calc;
		for (i = 0; i < 4; i++) {
			for (j = 0; j < 4; j++) {
				if (j == i) {
					continue;
				}
				for (k = 0; k < 4; k++) {
					if (k == i || k == j) {
						continue;
					}
					a[0] = array[i]; a[1] = array[j];
					a[2] = array[k]; a[3] = array[6 - i - j - k];
					if (null != sort_func) {	
						sort_func(a);
					}
					result = calc_func(a);
					var expr = TEMPLATES_ALL[t].expr.replace('%d', a[0]).replace('%d', a[1]).replace('%d', a[2]).replace('%d', a[3]);
					if (Math.abs(result - goal) < 0.0000001 && -1 == answer_all.indexOf(expr)) {
						answer_all.push(expr);
					}
				}
			}
		}
	}
	return answer_all;
}

function calc24Game() {
	var num1 = Number(document.getElementById('num1').value);
	var num2 = Number(document.getElementById('num2').value);
	var num3 = Number(document.getElementById('num3').value);
	var num4 = Number(document.getElementById('num4').value);
	var goal = document.getElementById('goal').value;
	var result_show = document.getElementById('calc24_result');
	result_show.innerHTML = '';

	if (isNaN(goal) || goal < 0 || goal == '') {
		document.getElementById('goal').value = 24;
		result_show.innerHTML = '&nbsp;';
		return;
	}
	var result = getAnswer(Number(goal), num1, num2, num3, num4);
	if (result.length == 0) {
		result_show.innerHTML = 'No Answer.';
	} else {
		for (var i = 0; i < result.length; i++) {
			result_show.innerHTML += result[i] + ' = ' + goal + '<br/>';
		}
	}
}
		</script>
	</head>
	<body>
		<p>
			<select id='num1'>
				<option value='1'>1</option>
				<option value='2'>2</option>
				<option value='3'>3</option>
				<option value='4'>4</option>
				<option value='5'>5</option>
				<option value='6'>6</option>
				<option value='7'>7</option>
				<option value='8'>8</option>
				<option value='9'>9</option>
				<option value='10'>10</option>
				<option value='11'>11</option>
				<option value='12'>12</option>
				<option value='13'>13</option>
			</select>
			<select id='num2'>
				<option value='1'>1</option>
				<option value='2'>2</option>
				<option value='3'>3</option>
				<option value='4'>4</option>
				<option value='5'>5</option>
				<option value='6'>6</option>
				<option value='7'>7</option>
				<option value='8'>8</option>
				<option value='9'>9</option>
				<option value='10'>10</option>
				<option value='11'>11</option>
				<option value='12'>12</option>
				<option value='13'>13</option>
			</select>
			<select id='num3'>
				<option value='1'>1</option>
				<option value='2'>2</option>
				<option value='3'>3</option>
				<option value='4'>4</option>
				<option value='5'>5</option>
				<option value='6'>6</option>
				<option value='7'>7</option>
				<option value='8'>8</option>
				<option value='9'>9</option>
				<option value='10'>10</option>
				<option value='11'>11</option>
				<option value='12'>12</option>
				<option value='13'>13</option>
			</select>
			<select id='num4'>
				<option value='1'>1</option>
				<option value='2'>2</option>
				<option value='3'>3</option>
				<option value='4'>4</option>
				<option value='5'>5</option>
				<option value='6'>6</option>
				<option value='7'>7</option>
				<option value='8'>8</option>
				<option value='9'>9</option>
				<option value='10'>10</option>
				<option value='11'>11</option>
				<option value='12'>12</option>
				<option value='13'>13</option>
			</select>
		<p>
		</p>
			Goal: <input type='text' id='goal' size='2' maxlength='2' value='24'/>
			<input type='button' onclick='calc24Game();' value='Calculate'/>
		</p>
		<p id='calc24_result'>&nbsp;</p>
	</body>
</html>

