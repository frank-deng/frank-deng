<!DOCTYPE html>
<html>
	<head>
		<meta name='viewport' id='viewport' content='width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no'/>
		<meta charset='UTF-8'/>
		<title>使用Python3获取系统信息 - Frank的空间</title>
		<link rel='stylesheet' type='text/css' href='/css/common.css'/>
		<link rel='stylesheet' type='text/css' href='/css/document.css'/>
	</head>
	<body>
		<div class='header-wrapper'>
			<div class='header'>
				
<a class='site-title' href='/zh-CN/'>Frank的空间</a>


			</div>
		</div>
		<div class='main-content'>
			<h1 id="python3">使用Python3获取系统信息</h1>

<h2 id="cpu">获取CPU温度</h2>

<p>读取<code class="highlighter-rouge">/sys/class/thermal/thermal_zone0/temp</code>文件中的内容，除以1000后，即可获得CPU的温度，单位为摄氏度。</p>

<p>适用环境：</p>

<ul>
  <li>Linux</li>
  <li>Android + QPython3</li>
</ul>

<p>代码示例：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>with open('/sys/class/thermal/thermal_zone0/temp', 'r') as fp:
    result_c = fp.readline();
cpu_temp = int(float(result_c) / 1000.0); #获取CPU温度
</code></pre>
</div>

<h2 id="nvidia-gpu">获取Nvidia GPU温度</h2>

<p>运行<code class="highlighter-rouge">nvidia-smi -q -x</code>命令，并将该命令的标准输出作为XML进行解析，即可获得GPU的温度，单位为摄氏度。</p>

<p>适用环境：</p>

<ul>
  <li>Windows（需要安装Nvidia官方驱动）</li>
  <li>Linux（需要安装Nvidia官方驱动）</li>
</ul>

<p>代码示例：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>import subprocess;
import xml.etree.ElementTree as ET;
nvidia_smi = subprocess.Popen(['nvidia-smi', '-q', '-x'], stdout=subprocess.PIPE);
tree = ET.fromstring(nvidia_smi.communicate()[0]);
result_c = tree.findall('./gpu/temperature/gpu_temp')[0].text;
gpu_temp = int(result_c.replace(' C', '')); #获取GPU温度
</code></pre>
</div>

<h2 id="android">获取Android手机电池电量</h2>

<p>使用SL4A的<a href="http://www.mithril.com.au/android/doc/BatteryManagerFacade.html">BatteryManagerFacade</a> API获取手机电池电量。</p>

<p>适用环境：</p>

<ul>
  <li>Android + QPython3</li>
</ul>

<p>代码示例：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>import android;
droid = android.Android();
droid.batteryStartMonitoring();
battery_level = droid.batteryGetLevel()[1]; #获取Android手机电池电量
droid.batteryStopMonitoring();
</code></pre>
</div>

<h2 id="cpu-1">获取总CPU使用率</h2>

<p>通过分析<code class="highlighter-rouge">/proc/stat</code>文件中的内容获取CPU使用率。</p>

<p>适用环境：</p>

<ul>
  <li>Linux</li>
  <li>Android + QPython3</li>
</ul>

<p>代码示例：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>import time;
def cpu_usage(sample_interval):
    with open('/proc/stat', 'r') as fp:
        info0 = fp.readline();
    time.sleep(sample_interval);
    with open('/proc/stat', 'r') as fp:
        info1 = fp.readline();
    info0 = [int(n) for n in info0.split()[1:]];
    info1 = [int(n) for n in info1.split()[1:]];
    return float(sum(info1[0:3]) - sum(info0[0:3])) / float(sum(info1) - sum(info0));

# 调用cpu_usage()函数
print(cpu_usage(0.1));
</code></pre>
</div>

<h2 id="cpu-2">获取每个CPU的使用率</h2>

<p>通过分析<code class="highlighter-rouge">/proc/stat</code>文件中的内容获取CPU数量，以及每个CPU的使用率。</p>

<p>适用环境：</p>

<ul>
  <li>Linux</li>
  <li>Android + QPython3</li>
</ul>

<p>代码示例：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>import time, re;
__re_cpu = re.compile(r'cpu\d+');
def cpu_usage_each(sample_interval):
    with open('/proc/stat', 'r') as fp:
        lines0 = fp.readlines();
    time.sleep(sample_interval);
    with open('/proc/stat', 'r') as fp:
        lines1 = fp.readlines();
    lines0 = [l.split() for l in lines0];
    lines1 = [l.split() for l in lines1];
    info0, info1, result = [], [], [];
    for l in lines0:
        if None != __re_cpu.match(l[0]):
            info0.append([int(n) for n in l[1:]]);
    for l in lines1:
        if None != __re_cpu.match(l[0]):
            info1.append([int(n) for n in l[1:]]);
    for i in range(len(info0)):
        total = sum(info1[i]) - sum(info0[i]);
        if 0 == total:
            result.append(0.0);
        else:
            result.append(float(sum(info1[i][0:3]) - sum(info0[i][0:3])) / float(total));
    return result;

# 调用cpu_usage_each()函数
print(cpu_usage_each(0.1));
</code></pre>
</div>

<h2 id="section">获取内存使用率</h2>

<p>通过分析<code class="highlighter-rouge">/proc/meminfo</code>文件中的内容获取内存使用率。</p>

<p>适用环境：</p>

<ul>
  <li>Linux</li>
  <li>Android + QPython3</li>
</ul>

<p>代码示例：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>import re;
__re_mem_total = re.compile(r'MemTotal:\s*(\d+)');
__re_mem_free = re.compile(r'MemFree:\s*(\d+)');
__re_mem_buffers = re.compile(r'Buffers:\s*(\d+)');
__re_mem_cache = re.compile(r'Cached:\s*(\d+)');
def mem_usage():
    with open('/proc/meminfo', 'r') as fp:
        meminfo = fp.readlines();
    total, avail = 1, 0;
    for line in meminfo:
        m_total = __re_mem_total.match(line);
        m_free = __re_mem_free.match(line);
        m_buffers = __re_mem_buffers.match(line);
        m_cache = __re_mem_cache.match(line);
        if None != m_total:
            total = int(m_total.groups()[0]);
        elif None != m_free:
            avail += int(m_free.groups()[0]);
        elif None != m_buffers:
            avail += int(m_buffers.groups()[0]);
        elif None != m_cache:
            avail += int(m_cache.groups()[0]);
    return float(total-avail)/float(total);

# 调用mem_usage()函数
print(mem_usage());
</code></pre>
</div>

<h2 id="section-1">获取开机时间</h2>

<p>通过分析<code class="highlighter-rouge">/proc/uptime</code>文件中的内容获取从开机到现在的秒数。</p>

<p>适用环境：</p>

<ul>
  <li>Linux</li>
  <li>Android + QPython3</li>
</ul>

<p>代码示例：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>from datetime import datetime, timedelta;
def boot_time():
    with open('/proc/uptime', 'r') as fp:
        uptime = fp.readline();
    uptime = float(uptime.split()[0]);
    return (datetime.now() - timedelta(0, uptime));

# 调用boot_time()函数
print(boot_time().strftime('%Y-%m-%dT%H:%M:%S'));
</code></pre>
</div>

<h2 id="psutilcpu">使用<code class="highlighter-rouge">psutil</code>获取CPU使用率、内存使用率、开机时间</h2>

<p>使用<a href="http://pythonhosted.org/psutil/"><code class="highlighter-rouge">psutil</code></a>提供的API获取CPU使用率（单位为百分比）、内存使用率（单位为百分比）、开机时间。</p>

<p>需要另外安装<a href="https://pypi.python.org/pypi/psutil"><code class="highlighter-rouge">psutil</code></a>模块。</p>

<p>适用环境：</p>

<ul>
  <li>Windows</li>
  <li>Linux</li>
</ul>

<p>代码示例（获取CPU使用率）：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>import psutil;
from datetime import datetime;

#获取总CPU使用率
cpu_usage = psutil.cpu_percent(0.1);

#获取内存使用率
meminfo = psutil.virtual_memory();
mem_usage = (meminfo.total - meminfo.available) / meminfo.total * 100;

#获取开机时间
boot_time = datetime.fromtimestamp(psutil.boot_time()).strftime('%Y-%m-%dT%H:%M:%S');
</code></pre>
</div>

		</div>
	</body>
</html>

