<!DOCTYPE html>
<html>
	<head>
		<meta name='viewport' id='viewport' content='width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no'/>
		<meta charset='UTF-8'/>
		<title>一些好用的代码片段</title>
		<link rel='stylesheet' type='text/css' href='/css/document.css'/>
	</head>
	<body>
		<h1 id="section">一些好用的代码片段</h1>

<h3 id="javascripthtmlspecialchars">用JavaScript实现<code class="highlighter-rouge">htmlspecialchars()</code></h3>

<div class="highlighter-rouge"><pre class="highlight"><code>function htmlspecialchars(s){
	var M={'&amp;':'&amp;amp;','&lt;':'&amp;lt;','&gt;':'&amp;gt;','"':'&amp;quot;',"'":'&amp;#039;'};
	return s.replace(/[&amp;&lt;&gt;"']/g,function(m){return M[m]});
}
</code></pre>
</div>

<h3 id="javascripttrim-ltrim-rtrim">用JavaScript实现<code class="highlighter-rouge">trim()</code>, <code class="highlighter-rouge">ltrim()</code>, <code class="highlighter-rouge">rtrim()</code></h3>

<div class="highlighter-rouge"><pre class="highlight"><code>str.replace(/(^\s*)|(\s*$)/g,'');	//trim()
str.replace(/(^\s*)/g,'');	//ltrim()
str.replace(/(\s*$)/g,'');	//rtrim()
</code></pre>
</div>

<h3 id="user-agent">通过User Agent获取浏览器类型</h3>

<div class="highlighter-rouge"><pre class="highlight"><code>function deviceType() {
	var ua = window.navigator.userAgent;
	if (/iphone|android.*mobile/i.test(ua)) {
		return 'mobile';
	} else if (/ipad|android/i.test(ua)) {
		return 'pad';
	}
	return undefined;
}
</code></pre>
</div>

<p>This function returns <code class="highlighter-rouge">mobile</code> for mobile browsers, <code class="highlighter-rouge">pad</code> for tablet browsers. <code class="highlighter-rouge">undefined</code> for PC browsers or browsers of other type.</p>

<h3 id="chrome-for-android-change-address-bar-color">Chrome for Android: Change address bar color.</h3>

<p>Add the following meta tag into HTML to change address bar color in Chrome for Android.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>&lt;meta name="theme-color" content="#db5945"/&gt;
</code></pre>
</div>

<h3 id="fetch-cpu-temperature-via-python">Fetch CPU temperature via python</h3>

<div class="highlighter-rouge"><pre class="highlight"><code>fp = open('/sys/class/thermal/thermal_zone0/temp', 'r');
result_c = fp.readline();
fp.close();
return int(float(result_c) / 1000.0);
</code></pre>
</div>

<h3 id="fetch-nvidia-gpu-temperature-using-nvidia-smi-via-python">Fetch NVIDIA GPU temperature using nvidia-smi via Python</h3>

<div class="highlighter-rouge"><pre class="highlight"><code>import subprocess, xml.etree.ElementTree as ET;
nvidia_smi = subprocess.Popen(['nvidia-smi', '-q', '-x'], stdout=subprocess.PIPE);
tree = ET.fromstring(nvidia_smi.communicate()[0]);
result_c = tree.findall('./gpu/temperature/gpu_temp')[0].text;
return int(result_c.replace(' C', ''));
</code></pre>
</div>

<h3 id="convert-video-into-html5-compatible-format">Convert video into HTML5 compatible format</h3>

<div class="highlighter-rouge"><pre class="highlight"><code>avconv -i INPUT_FILE -c:v libx264 -crf 18 -c:a aac -q:a 100 -strict experimental OUTPUT.mp4
</code></pre>
</div>

<h3 id="convert-audio-into-320k-mp3">Convert audio into 320k MP3</h3>

<div class="highlighter-rouge"><pre class="highlight"><code>avconv -i INPUT_FILE -acodec libmp3lame -ab 320k OUTPUT.mp3
</code></pre>
</div>

<h3 id="extract-basename-and-extension-of-a-filename">Extract basename and extension of a filename</h3>

<div class="highlighter-rouge"><pre class="highlight"><code>BASENAME="${FILENAME%.*}";
EXTENSION="${FILENAME##*.}";
</code></pre>
</div>

<h3 id="launch-gui-program-from-terminal-with-stdout-and-stderr-supressed">Launch GUI program from terminal with stdout and stderr supressed</h3>

<p>Create <code class="highlighter-rouge">/usr/local/bin/xexec</code> with the code below:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c">#!/bin/bash</span>
<span class="nb">exec</span> <span class="nv">$@</span> &amp;&gt;/dev/null &amp;
<span class="nb">exit </span>0;
</code></pre>
</div>

<p>Add <code class="highlighter-rouge">complete -cf xexec</code> to <code class="highlighter-rouge">~/.bashrc</code> for tab completion.</p>

<p>Finally, you can append xexec to the command you’d like to run, so as to run GUI program at background with stdout and stderr supressed.</p>

<h3 id="usage-of-perls-rename-utility">Usage of Perl’s rename utility</h3>

<p>Replace the file extension from <code class="highlighter-rouge">.jpeg</code> to <code class="highlighter-rouge">.jpg</code></p>

<div class="highlighter-rouge"><pre class="highlight"><code>prename 's/\.jpeg$/\.jpg/' *.jpeg
</code></pre>
</div>

<p>Change filenames into lower case</p>

<div class="highlighter-rouge"><pre class="highlight"><code>prename 's/\.jpeg$/\.jpg/' *.jpeg
</code></pre>
</div>

<p>Add prefix to <code class="highlighter-rouge">.txt</code> files</p>

<div class="highlighter-rouge"><pre class="highlight"><code>prename 's/(.*).txt$/prefix_$1.txt/' *.txt
</code></pre>
</div>

<h3 id="enumerate-records-separated-by-newlines">Enumerate records separated by newlines</h3>

<div class="highlighter-rouge"><pre class="highlight"><code>IFS=$'\n';
for LINE in `ls`; do
	#Do some works on "${LINE}"
done;
</code></pre>
</div>

<h3 id="enumerate-arguments-with-space-characters">Enumerate arguments with space characters</h3>

<div class="highlighter-rouge"><pre class="highlight"><code>while [ -n "${1}" ]; do
	FILENAME="${1}";
	#Do some works on "${FILENAME}"
	shift 1;
done;
</code></pre>
</div>

<h3 id="command-line-stopwatch-for-bash-shell">Command line stopwatch for bash shell</h3>

<p>Run the following command to start timing:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>time read
</code></pre>
</div>

<p>Press <code class="highlighter-rouge">Ctrl-d</code> to stop timing, and you will get how long the time passed during timing.</p>

<h3 id="record-system-output-sound-in-linux">Record system output sound in Linux</h3>

<div class="highlighter-rouge"><pre class="highlight"><code>pacat --record -d alsa_output.pci-0000_06_05.0.analog-stereo.monitor | sox -t raw -r 44100 -s -L -b 16 -c 2 - output.wav
pacat --record -d alsa_output.pci-0000_06_05.0.analog-stereo.monitor | avconv -f s16le -ar 44.1k -ac 2 -i pipe:0 record.wav
</code></pre>
</div>

<p><code class="highlighter-rouge">alsa_output.pci-0000_06_05.0.analog-stereo.monitor</code> is the device name corresponding to the soundcard to be monitored. Use command <code class="highlighter-rouge">pacmd list | grep ".monitor"</code> to get the correct device name.</p>

<h3 id="wifi-configuration-without-network-manager">Wifi Configuration Without Network Manager</h3>

<p>Use <code class="highlighter-rouge">ifconfig -a</code> to show all the network interfaces.</p>

<p>Create <code class="highlighter-rouge">/etc/network/wpa_supplicant.conf</code> with following lines:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>network={
	ssid="WLAN_AP_1"
	key_mgmt=WPA-PSK
	psk="WLAN_AP_PSK_1"
	priority=1
}
network={
	ssid="WLAN_AP_2"
	key_mgmt=WPA-PSK
	psk="WLAN_AP_PSK_2"
	priority=2
}
</code></pre>
</div>

<p>Add the following lines to <code class="highlighter-rouge">/etc/network/interfaces</code></p>

<div class="highlighter-rouge"><pre class="highlight"><code>auto wlan0
iface wlan0 inet dhcp
	wpa-conf /etc/network/wpa_supplicant.conf
</code></pre>
</div>

<h3 id="fix-unusable-ralink-wifi-controller-on-asus-laptop">Fix Unusable Ralink Wifi Controller On Asus Laptop</h3>

<p>Sometimes Ralink network controller on Asus laptop is unusable, with the following output generated by <code class="highlighter-rouge">sudo rfkill list all</code> command:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>0: phy0: Wireless LAN
	Soft blocked: no
	Hard blocked: yes
1: asus-wlan: Wireless LAN
	Soft blocked: no
	Hard blocked: no
</code></pre>
</div>

<p>To solve the problem, create <code class="highlighter-rouge">/etc/modprobe.d/asus.conf</code> with the following content:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>options asus_nb_wmi wapf=4
</code></pre>
</div>

<p>Then reboot.</p>

<h3 id="configure-lightdm-for-automatic-login">Configure LightDM For Automatic Login</h3>

<p>Execute command:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>groupadd autologin &amp;&amp; gpasswd -a frank autologin
</code></pre>
</div>

<p>Append the following lines to <code class="highlighter-rouge">/etc/lightdm/lightdm.conf</code>. (If this configuration file does not exist, create it)</p>

<div class="highlighter-rouge"><pre class="highlight"><code>[SeatDefaults]
autologin-user=frank
autologin-user-timeout=0
</code></pre>
</div>

<p>Reboot to check whether it works.</p>

<h3 id="improve-sound-quality-for-alsa">Improve Sound Quality for ALSA</h3>

<p>Edit <code class="highlighter-rouge">/usr/share/alsa/alsa.conf</code> and change line <code class="highlighter-rouge">defaults.pcm.dmix.rate 48000</code> to <code class="highlighter-rouge">defaults.pcm.dmix.rate 44100</code>.</p>

<h3 id="change-the-behaviour-when-closing-laptop">Change The Behaviour When Closing Laptop</h3>

<p>Edit <code class="highlighter-rouge">/etc/systemd/login.conf</code> and change the following settings:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>HandleLidSwitch=ignore
HandleSuspendKey=hibernate
</code></pre>
</div>

<h3 id="prevent-firefox-from-creating-directories-automatically">Prevent FireFox From Creating Directories Automatically</h3>

<p>Create or modify <code class="highlighter-rouge">~/.config/user-dirs.dirs</code> with the following configuration:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>XDG_DESKTOP_DIR="$HOME/"
XDG_DOWNLOAD_DIR="$HOME/"
XDG_TEMPLATES_DIR="$HOME/"
XDG_PUBLICSHARE_DIR="$HOME/"
XDG_DOCUMENTS_DIR="$HOME/"
XDG_MUSIC_DIR="$HOME/"
XDG_PICTURES_DIR="$HOME/"
XDG_VIDEOS_DIR="$HOME/"
</code></pre>
</div>

<h3 id="notes-for-virtualbox">Notes for VirtualBox</h3>

<p>Execute the following command on the host machine when you’re unable to use USB devices in guest machines:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>gpasswd -a frank vboxusers
</code></pre>
</div>

<p>Fix unbootable EFI-based Debian/Ubuntu guests:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>cd /boot/efi/EFI
mkdir boot
cp ubuntu/grubx64.efi boot/bootx64.efi #For Ubuntu 
cp debian/grubx64.efi boot/bootx64.efi #For Debian
</code></pre>
</div>

<h3 id="adjust-tab-size-for-vim">Adjust Tab Size For VIM</h3>

<p>Add the following lines to <code class="highlighter-rouge">/etc/vim/vimrc</code>:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>set tabstop=4
set softtabstop=4
set shiftwidth=4
</code></pre>
</div>

<h3 id="change-timezone">Change timezone</h3>

<div class="highlighter-rouge"><pre class="highlight"><code>sudo dpkg-reconfigure tzdata.
</code></pre>
</div>

<h3 id="change-current-time">Change current time</h3>

<div class="highlighter-rouge"><pre class="highlight"><code>date -s MM/DD/YYYY
date -s hh:mm:ss
</code></pre>
</div>

<h3 id="add-support-for-other-locales">Add support for other locales</h3>

<ol>
  <li>Edit <code class="highlighter-rouge">/etc/locale.gen</code> and uncomment locales you’d like to support.</li>
  <li>Run locale-gen.</li>
  <li>
    <p>Change environment variable <code class="highlighter-rouge">LANG</code> and <code class="highlighter-rouge">LC_ALL</code>. Following is an example:</p>

    <p>export LC_ALL=zh_CN.UTF-8
 export LANG=zh_CN.UTF-8</p>
  </li>
</ol>


	</body>
</html>

