<!DOCTYPE html>
<html>
	<head>
		<meta name='viewport' id='viewport' content='width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no'/>
		<meta charset='UTF-8'/>
		<title>Gambler's Ruin</title>
		<style type='text/css'>
#disp_result{
	display:none;
}
		</style>
	</head>
	<body>
		<form id='form_gamble'>
			<table>
				<tr>
					<td>Money&nbsp;</td>
					<td><input type='text' required='required' pattern='\d+' name='money' value='1000000'/></td>
				</tr>
				<tr>
					<td>Bet&nbsp;</td>
					<td><input type='text' required='required' pattern='\d+' name='bet' value='100'/></td>
				</tr>
			</table>
			<button name='btn_submit'>Go!!!</button>
		</form>
		<div id='disp_result'></div>
	</body>
	<script type='text/javascript'>
var form_gamble = document.getElementById('form_gamble');
var btn_submit = form_gamble.querySelector('[name=btn_submit]');
var input_money = form_gamble.querySelector('[name=money]');
var input_bet = form_gamble.querySelector('[name=bet]');
var disp_result = document.getElementById('disp_result');
var disp_rounds = document.getElementById('disp_rounds');

input_money.removeAttribute('disabled');
input_bet.removeAttribute('disabled');
input_money.value = 1000000;
input_bet.value = 100;
btn_submit.removeAttribute('disabled');

var worker = undefined;
form_gamble.addEventListener('submit', function(e){
	e.preventDefault();
	if (worker != undefined) {
		return false;
	} else if (!window.Worker){
		alert('Web Worker not available!');
		return false;
	}
	btn_submit.style.display = 'none';
	input_money.setAttribute('disabled', 'disabled');
	input_bet.setAttribute('disabled', 'disabled');
	worker = new Worker('js/gambler.js');
	worker.postMessage({money:Number(input_money.value), bet:Number(input_bet.value)});
	worker.addEventListener('message', function(e){
		form_gamble.style.display = 'none';
		disp_result.style.display = 'block';
		if (e.data.money > 0) {
			disp_result.innerHTML = 'The gambler now has '+e.data.money+'.';
		} else {
			disp_result.innerHTML = 'The gambler bankrupts after gambling for '+e.data.rounds+' rounds.';
		}
	});
	return false;
});
	</script>
</html>

